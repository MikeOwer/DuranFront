<div class="card flex flex-col gap-14">
  <p-toolbar class="gap-10">
    <ng-template #start>
      <h1 class="font-semibold text-xl">{{titulo}}</h1>
    </ng-template>
    <ng-template #end>
      <button pButton variant="text" severity="secondary" label="Limpiar filtros" icon="pi pi-filter-slash"
        class="p-button-sm p-button-rounded mr-2" (click)="clearFilters()"></button>
      <input pInputText class="mr-2" type="text" name="buscador" placeholder="Buscar" [(ngModel)]="globalFilter"
        [ngModelOptions]="{standalone: true}" (input)="onFilterGlobal($event)" />
     
      <button pButton icon="pi pi-pencil" class="p-button-sm p-button-rounded mr-2" (click)="link(undefined,'cotizar')">
        Cotizar
      </button>
    </ng-template>
  </p-toolbar>
  <p-table #dt [value]="data" [paginator]="true" [rows]="10"
    [globalFilterFields]="['cliente', 'telefono', 'status', 'saldo', 'monto', 'etapa']" [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}" [rowsPerPageOptions]="[5,10,20]">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id">Credito <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="cliente">Cliente <p-sortIcon field="cliente"></p-sortIcon>
          <!-- <input pInputText type="text" (input)="onFilterColumn($event, 'nombre')" class="w-full" /> -->
        </th>
        <th pSortableColumn="telefono">Telefono <p-sortIcon field="telefono"></p-sortIcon>
          <!-- <input pInputText type="text" (input)="onFilterColumn($event, 'apellido')" class="w-full" /> -->
        </th>
        <th pSortableColumn="status">Estatus <p-sortIcon field="status"></p-sortIcon>
          <!-- <input pInputText type="text" (input)="onFilterColumn($event, 'email')" class="w-full" /> -->
        </th>
        <th pSortableColumn="saldo">Saldo <p-sortIcon field="saldo"></p-sortIcon>
          <!-- <input pInputText type="text" (input)="onFilterColumn($event, 'celular')" class="w-full" /> -->
        </th>
        <th pSortableColumn="monto">Monto <p-sortIcon field="monto"></p-sortIcon></th>
        <th pSortableColumn="created">Firmado <p-sortIcon field="created"></p-sortIcon></th>
        <th pSortableColumn="etapa">Etapa <p-sortIcon field="etapa"></p-sortIcon></th>
        <th>Opciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-data>
      <tr>
        <td>{{ data.id }}</td>
        <td>{{ data.cliente.name }}</td>
        <td>{{ data.cliente.cellphone_number }}</td>
        <td>{{ data.status }}</td>
        <td>{{ data.saldo }}</td>
        <td>{{ data.monto }}</td>
        <td>{{ data.created_at | date:'dd/MM/yyyy' }}</td>
        <td>{{ data.etapa }}</td>
        <td>
          <button pButton icon="pi pi-pencil" class="p-button-sm p-button-rounded mr-2 mb-2"
            (click)="link(data.id,'editar/')"></button>
          <button pButton icon="pi pi-bars" class="p-button-sm p-button-rounded  mr-2 mb-2 p-button-info"
            (click)="onClickPlazos(data)"></button>
          <button pButton icon="pi pi-eye" class="p-button-sm p-button-rounded  mr-2 mb-2 p-button-info"
            (click)="onClickInfo(data)"></button>
          <button pButton icon="pi pi-trash" class="p-button-sm p-button-rounded mr-2 mb-2 p-button-danger"
            (click)="confirmDelete(data)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="displayModal" [closable]="false" [modal]="true" [responsive]="true" [style]="{width: '50vw'}"
  [dismissableMask]="true">
  <ng-template pTemplate="header">
    <div class="flex justify-between items-center w-full">
      <h2 class="text-lg font-semibold">Plazos del Crédito</h2>
      <button pButton icon="pi pi-times" class="p-button-sm p-button-rounded p-button-secondary"
        (click)="displayModal = false"></button>
    </div>
  </ng-template>
  <p-table [value]="plazos" [paginator]="true" [rows]="5"
    [globalFilterFields]="['plazo', 'monto', 'tasa', 'pagoMensual']">
    <ng-template pTemplate="header">
      <tr>
        <th>Plazo</th>
        <th>Monto</th>
        <th>Tasa de interés</th>
        <th>Pago interés</th>
        <th>Pago capital</th>
        <th>Pago Mensual</th>
        <th>Fecha de pago</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-plazo>
      <tr>
        <td>{{ plazo.plazo }}</td>
        <td>{{ plazo.monto | currency }}</td>
        <td>{{ plazo.tasa }}%</td>
        <td>{{ plazo.pagoInteres | currency }}</td>
        <td>{{ plazo.pagoCapital | currency }}</td>
        <td>{{ plazo.pagoMensual | currency }}</td>
        <td>{{ plazo.fechaDePago | date:'dd/MM/yyyy' }}</td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>

<p-dialog [(visible)]="showInfoDialog" [closable]="false" [modal]="true" [responsive]="true" [style]="{width: '60vw'}"
  [dismissableMask]="true" [contentStyle]="{padding: '2rem'}">

  <ng-template pTemplate="header">
    <div class="flex justify-between items-center w-full">
      <h2 class="text-2xl font-bold text-gray-800 m-0">Detalle del Crédito</h2>
      <button pButton icon="pi pi-times" class="p-button-rounded p-button-secondary p-button-sm"
        (click)="showInfoDialog = false"></button>
    </div>
  </ng-template>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 text-base text-gray-800">
    <!-- Crédito -->
    <div class="shadow-md border border-gray-200 rounded-xl p-6 bg-white">
      <h3 class="text-2xl font-semibold mb-2 text-blue-700 flex items-center gap-2">
        <i class="pi pi-dollar"></i> Crédito
      </h3>
      <div class="space-y-1">
        <p class="m-0"><strong>Monto:</strong> {{ selectedCredit?.monto | currency }}</p>
        <p><strong>Enganche:</strong> {{ selectedCredit?.enganche | currency }}</p>
        <p><strong>Saldo:</strong> {{ selectedCredit?.saldo | currency }}</p>
        <p><strong>Pago capital:</strong> {{ selectedCredit?.pago_capital | currency }}</p>
        <p><strong>Pago mensual:</strong> {{ selectedCredit?.pago_mensual | currency }}</p>
        <p><strong>Interés:</strong> {{ selectedCredit?.interes }}%</p>
        <p><strong>Tasa FMD:</strong> {{ selectedCredit?.tasa_fmd }}%</p>
        <p><strong>Moratorio diario:</strong> {{ selectedCredit?.moratorio_diario | currency }}</p>
        <p><strong>Plazo:</strong> {{ selectedCredit?.plazo }} meses</p>
        <p><strong>Fecha inicial:</strong> {{ selectedCredit?.fecha_inicial | date }}</p>
      </div>
    </div>

    <!-- Cliente y Aval -->
    <div class="flex flex-col gap-6 text-base text-gray-800">
      <!-- Cliente -->
      <div class="shadow-md border border-gray-200 rounded-xl p-6 bg-white">
        <h3 class="text-2xl font-semibold mb-2 text-green-700 flex items-center gap-2">
          <i class="pi pi-user"></i> Cliente
        </h3>
        <div class="space-y-1">
          <p class="m-0"> <strong>Nombre:</strong> {{ cliente?.name }}</p>
          <p><strong>Teléfono:</strong> {{ cliente?.phone_number }}</p>
          <p><strong>Celular:</strong> {{ cliente?.cellphone_number }}</p>
          <p><strong>Email:</strong> {{ cliente?.email }}</p>
          <p><strong>Dirección:</strong> {{ cliente?.address }}</p>
        </div>
      </div>

      <!-- Aval -->
      <div class="shadow-md border border-gray-200 rounded-xl p-6 bg-white">
        <h3 class="text-2xl font-semibold mb-2 text-orange-700 flex items-center gap-2">
          <i class="pi pi-users"></i> Aval
        </h3>
        <div class="space-y-1">
          <p class="m-0"><strong>Nombre:</strong> {{ aval?.name }}</p>
          <p><strong>Teléfono:</strong> {{ aval?.phone_number }}</p>
          <p><strong>Celular:</strong> {{ aval?.cellphone_number }}</p>
          <p><strong>Email:</strong> {{ aval?.email }}</p>
          <p><strong>Dirección:</strong> {{ aval?.address }}</p>
        </div>
      </div>
    </div>
  </div>
</p-dialog>




<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>