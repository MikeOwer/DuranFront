<div class="card flex flex-col gap-14">
    <p-toolbar class="gap-10">
        <ng-template #start>
            <h1 class="font-semibold text-xl">{{titulo}}</h1>
        </ng-template>
        <ng-template #end>
            <button pButton variant="text" severity="secondary" label="Limpiar filtros" icon="pi pi-filter-slash"
                class="p-button-sm p-button-rounded mr-2" (click)="clearFilters()"></button>
            <input pInputText class="custom-input mr-2" type="text" name="buscador" placeholder="Buscar"
                [(ngModel)]="globalFilter" [ngModelOptions]="{standalone: true}" (input)="onFilterGlobal($event)" />


        </ng-template>
    </p-toolbar>
    <div #start class="flex justify-between mb-4">
        <button pButton type="button" icon="pi pi-arrow-left" label="Regresar" class="p-button-secondary"
            (click)="goBack()"></button>

        <button pButton type="button" icon="pi pi-money-bill" label="Retirar" class="p-button-primary"
            (click)="showRetiro()"></button>
    </div>

    <p-table #dt [value]="billing" [paginator]="true" [rows]="10" stripedRows
        [globalFilterFields]="['nombre', 'apellido', 'email', 'celular']" [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}" [rowsPerPageOptions]="[5,10,20]">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="date">Fecha <p-sortIcon field="date"></p-sortIcon></th>
                <th pSortableColumn="concept">Concepto<p-sortIcon field="concept"></p-sortIcon>
                </th>
                <th pSortableColumn="capital_cobrado">Capital cobrado<p-sortIcon field="capital_cobrado"></p-sortIcon>
                </th>
                <th pSortableColumn="interes_cobrado">Inter√©s cobrado<p-sortIcon field="interes_cobrado"></p-sortIcon>
                </th>
                <th pSortableColumn="iva">IVA<p-sortIcon field="iva"></p-sortIcon>
                </th>
                <th pSortableColumn="total">Total<p-sortIcon field="total"></p-sortIcon></th>

            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-billing>
            <tr>
                <td>{{ billing.fecha | date:'dd-MM-yyyy'}}</td>
                <td>{{  billing.concepto }}</td>
                <td>{{  billing.capital_cobrado  | currency}} </td>
                <td>{{  billing.interes_cobrado | currency}}</td>
                <td>{{  billing.IVA | currency}}</td>
                <td>{{  billing.total_cobrado | currency}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td><strong>TOTAL</strong></td>
                <td></td>
                <td>{{ getTotal('capital_cobrado') | currency }}</td>
                <td>{{ getTotal('interes_cobrado') | currency }}</td>
                <td>{{ getTotal('IVA') | currency }}</td>
                <td>{{ getTotal('total_cobrado') | currency }}</td>
            </tr>
        </ng-template>
    </p-table>

    <p-table #dt [value]="investments" [paginator]="true" [rows]="10" stripedRows
        [globalFilterFields]="['nombre', 'apellido', 'email', 'celular']" [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}" [rowsPerPageOptions]="[5,10,20]">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="date">Fecha <p-sortIcon field="date"></p-sortIcon></th>
                <th pSortableColumn="concept">Concepto<p-sortIcon field="concept"></p-sortIcon>
                </th>
                <th></th>
                <th></th>
                <th></th>
                <th pSortableColumn="cantity">Cantidad<p-sortIcon field="cantity"></p-sortIcon></th>

            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-investments>
            <tr>
                <td>{{ investments.fecha | date:'dd-MM-yyyy'}}</td>
                <td>{{  investments.nombre }}</td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{  investments.cantidad | currency}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td><strong>TOTAL</strong></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ getTotalInvestments('cantidad') | currency }}</td>
            </tr>
        </ng-template>
    </p-table>

    <p-table #dt [value]="withdrawals" [paginator]="true" [rows]="10" stripedRows
        [globalFilterFields]="['nombre', 'apellido', 'email', 'celular']" [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}" [rowsPerPageOptions]="[5,10,20]">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="date">Fecha <p-sortIcon field="date"></p-sortIcon></th>
                <th pSortableColumn="concept">Concepto<p-sortIcon field="concept"></p-sortIcon>
                </th>
                <th></th>
                <th></th>
                <th></th>
                <th pSortableColumn="cantity">Cantidad<p-sortIcon field="cantity"></p-sortIcon></th>

            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-withdrawals>
            <tr>
                <td>{{ withdrawals.fecha | date:'dd-MM-yyyy'}}</td>
                <td>{{  withdrawals.concepto }}</td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{  withdrawals.cantidad | currency}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td><strong>TOTAL</strong></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ getTotalWithdrawals('cantidad') | currency }}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Dialogo de retiro -->
<p-dialog [(visible)]="showWithdrawalDialog" [closable]="false" [modal]="true" [responsive]="true"
    [style]="{width: '30vw'}" [dismissableMask]="true">
    <ng-template pTemplate="header">
        <div class="flex justify-between items-center w-full mx-8">
            <h2 class="text-lg font-semibold">Solicitud de Retiro</h2>
            <button pButton icon="pi pi-times" class="p-button-sm p-button-rounded p-button-secondary"
                (click)="showWithdrawalDialog = false"></button>
        </div>
    </ng-template>
    <ng-template pTemplate="content">
        <form [formGroup]="withdrawalForm" (ngSubmit)="submitWithdrawal()" class="mx-8">
            <div class="field mb-2 w-2/3">
                <p-inputGroup>
                    <p-inputGroupAddon><i class="pi pi-dollar"></i></p-inputGroupAddon>
                    <input pInputText type="number" id="amount" formControlName="amount"
                        placeholder=" Cantidad a retirar" min="0" />
                </p-inputGroup>
            </div>
            <div class="field mb-4 w-2/3">
                <p-inputGroup>
                    <p-inputGroupAddon><i class="pi pi-info-circle"></i></p-inputGroupAddon>
                    <input pInputText type="text" id="concept" formControlName="concept" placeholder=" Concepto" />
                </p-inputGroup>
            </div>
            <div class="flex align-center mt-4">
                <p-button label="Solicitar" type="button" (onClick)="requestWithdrawal()" class="w-1/4"></p-button>
                <p-button label="Cancelar" type="button" severity="secondary" class="w-1/4"
                    (click)="showWithdrawalDialog = false"></p-button>

                <p-button [disabled]="!isConfirmed" label="Retirar" type="submit" class="w-2/4 text-right"></p-button>
            </div>

        </form>
    </ng-template>

</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>