<div class="p-4">
  <a type="submit" pButton icon="pi pi-arrow-left" variant="text" severity="secondary" class="p-button-sm "
    style="display: inline-flex; align-items: center; gap: 0.5rem" (click)="onBack()">
    Regresar
  </a>
  <!-- Encabezado -->
  <h2 class="my-2">
    {{ cliente?.name?.toUpperCase() }} <span class=" text-muted-color text-xl ml-2"> {{ vehicle?.model }} -
      {{ vehicle?.year }}</span>
  </h2>

  <!-- Pagos Pendientes y Realizados -->
  <div class="p-grid gap-3">
    <!-- Pagos Pendientes -->
    <div class="p-col-12 p-md-6">
      <p-card header="Pagos Pendientes">
        <p-table [value]="pagosPendientes" [paginator]="true" [rows]="5" [responsiveLayout]="'scroll'">
          <ng-template pTemplate="header">
            <tr>
              <th>Letra</th>
              <th>Fecha de Pago</th>
              <th>Capital</th>
              <th>Interés</th>
              <th>Interés FMD</th>
              <th>Total</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-pago>
            <tr>
              <td>{{ pago.documento }}</td>
              <td>{{ pago.fecha_limite | date:'dd/MM/yyyy' }}</td>
              <td>{{ pago.capital | currency:'USD' }}</td>
              <td>{{ pago.interes | currency:'USD' }}</td>
              <td>{{ pago.interes_fmd | currency:'USD' }}</td>
              <td>{{ pago.monto | currency:'USD' }}</td>
            </tr>
          </ng-template>
        </p-table>

        <div class="mt-2 text-right">
          <button pButton label="Pagar" icon="pi pi-dollar" class="p-button-primary" (click)="openPago()"></button>
        </div>
      </p-card>
    </div>

    <!-- Pagos Realizados -->
    <div class="p-col-12 p-md-6 mt-4">
      <p-card header="Pagos Realizados">
        <p-table [value]="pagosRealizados" [paginator]="true" [rows]="5" [responsiveLayout]="'scroll'">
          <ng-template pTemplate="header">
            <tr>
              <th>Fecha</th>
              <th>Sucursal</th>
              <th>Monto</th>
              <th>Tipo de Pago</th>
              <th>Opciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-pago>
            <tr>
              <td>{{ pago.created_at | date:'dd/MM/yyyy' }}</td>
              <td>{{ pago.sucursal_name }}</td>
              <td>{{ pago.monto | currency:'USD' }}</td>
              <td>{{ pago.tipo_pago}}</td>
              <td>
                <button pButton icon="pi pi-file" class="p-button-rounded p-button-secondary p-button-sm"></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div class="mt-2 text-right">
          <button pButton label="Liquidar" icon="pi pi-check" class="p-button-info"></button>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Observaciones -->
  <div class="mt-4">
    <p-card header="Observaciones">
      <button pButton label="Agregar Observación" icon="pi pi-plus" class="p-button-success mb-2"
        (click)="displayObservationDialog = true"></button>
      <p-table [value]="observaciones" [paginator]="true" [rows]="5" [responsiveLayout]="'scroll'">
        <ng-template pTemplate="header">
          <tr>
            <th>Fecha</th>
            <th>Observación</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-obs>
          <tr>
            <td>{{ obs.fecha | date:'dd/MM/yyyy hh:mm a' }}</td>
            <td>{{ obs.observacion }}</td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="2" class="font-semibold text-lg" style="text-align: center;">No hay observaciones</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

<p-dialog header="Nueva Observación" [(visible)]="displayObservationDialog" [modal]="true" [style]="{ width: '400px' }"
  [closable]="true" [dismissableMask]="true">
  <div class="p-fluid">
    <div class="field">
      <textarea id="observation" [(ngModel)]="newObservation.text" rows="4" class="p-inputtextarea w-full p-4"
        placeholder="Escribe tu observación..."></textarea>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="closeDialog()"></button>
    <button pButton label="Guardar" icon="pi pi-check" (click)="saveObservation()"
      [disabled]="!newObservation.text"></button>
  </ng-template>
</p-dialog>

<!--Dialogo pago-->
<p-dialog header="Pago" [(visible)]="displayPagoDialog" [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '70vw' }" [closable]="true"
  [dismissableMask]="true">

  <div class="flex flex-row gap-8 mx-4">
    <div class="flex flex-col w-1/2">
      <form [formGroup]="pagoForm">
        <div class="field col-12 md:col-6 mb-3">
          <label for="importe">Importe</label>
          <p-inputGroup>
            <p-inputGroupAddon><i class="pi pi-dollar"></i></p-inputGroupAddon>
            <input pInputText id="importe" formControlName="importe" [readOnly]="true" />
          </p-inputGroup>
        </div>

        <div class="field col-12 md:col-6 mb-3">
          <label for="recibido">Dinero Recibido</label>
          <p-inputGroup>
            <p-inputGroupAddon><i class="pi pi-dollar"></i></p-inputGroupAddon>
            <input pInputText id="recibido" formControlName="recibido" />
          </p-inputGroup>
        </div>

        <div class="flex field col-12 md:col-6 mb-3 gap-4">
          <div class="w-1/2">

            <label for="formaPago">Forma de Pago</label>
            <p-dropdown [options]="formasPago" optionLabel="label" optionValue="value" placeholder="Forma de pago"
              formControlName="formaPago" id="formaPago" [showClear]="true" class="w-full">
              <ng-template let-option pTemplate="item">
                {{ option.label }}
              </ng-template>
            </p-dropdown>
          </div>

          <div class="w-1/2">

            <label for="tipoPago">Tipo de Pago</label>
            <p-dropdown [options]="tiposPago" optionLabel="label" optionValue="value" placeholder="Tipos de pago"
              formControlName="tipoPago" id="tipoPago" [showClear]="true" class="w-full">
              <ng-template let-option pTemplate="item">
                {{ option.label }}
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div class="field col-12 md:col-6 mb-3">
          <label for="cuentaDestino">Cuenta Destino</label>
          <p-dropdown [options]="cuentasDestino" optionLabel="label" optionValue="value" placeholder="Cuenta destino"
            formControlName="tipoPago" id="tipoPago" [showClear]="true" class="w-full">
            <ng-template let-option pTemplate="item">
              {{ option.label }}
            </ng-template>
          </p-dropdown>
        </div>

        <div class="field col-12 md:col-6 mb-3">
          <label for="cambio">Cambio</label>
          <p-inputGroup>
            <p-inputGroupAddon><i class="pi pi-dollar"></i></p-inputGroupAddon>
            <p-inputnumber id="cambio" formControlName="cambio" [readonly]="true" />
          </p-inputGroup>
        </div>
      </form>
    </div>

    <div class="flex-row col-12">
      <p-table [value]="pagosPendientes" [paginator]="true" [rows]="5" [responsiveLayout]="'scroll'">
        <ng-template pTemplate="header">
          <tr>
            <th>Letra</th>
            <th>Fecha de Pago</th>
            <th>Capital</th>
            <th>Interés</th>
            <th>Interés FMD</th>
            <th>Total</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-pago>
          <tr>
            <td>{{ pago.documento }}</td>
            <td>{{ pago.fecha_limite | date:'dd/MM/yyyy' }}</td>
            <td>{{ pago.capital | currency:'USD' }}</td>
            <td>{{ pago.interes | currency:'USD' }}</td>
            <td>{{ pago.interes_fmd | currency:'USD' }}</td>
            <td>{{ pago.monto | currency:'USD' }}</td>
          </tr>
        </ng-template>
      </p-table>

      <div class="field col-12 md:col-6 mb-3">
        <p>Total: <span class="text-lg font-bold">{{credito?.saldo}}</span></p>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="closeDialog()"></button>
    <button pButton label="Pagar" type="submit" icon="pi pi-check" (click)="submitPago()"></button>
  </ng-template>
</p-dialog>